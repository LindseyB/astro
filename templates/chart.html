{% extends "base.html" %}

{% block title %}Your Cosmic Chart - Astro Horoscope{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/copy-analysis.js') }}"></script>
<script src="{{ url_for('static', filename='js/button-loading.js') }}"></script>
<script src="{{ url_for('static', filename='js/music-suggestion.js') }}"></script>
{% if streaming %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="{{ url_for('static', filename='js/stream-analysis.js') }}"></script>
{% endif %}
<script>
    // Pass chart data to JavaScript for music suggestion
    window.chartDataForMusic = {
        birthDate: "{{ form_data.birth_date }}",
        birthTime: "{{ form_data.birth_time }}",
        timezoneOffset: "{{ form_data.timezone_offset }}",
        latitude: "{{ form_data.latitude }}",
        longitude: "{{ form_data.longitude }}",
        musicGenre: "{{ form_data.other_genre if form_data.music_genre == 'other' and form_data.other_genre else form_data.music_genre }}"
    };
    
    {% if streaming %}
    // Pass chart data for streaming analysis
    window.chartDataForStreaming = {
        pageType: 'chart',
        birthDate: "{{ form_data.birth_date }}",
        birthTime: "{{ form_data.birth_time }}",
        timezoneOffset: "{{ form_data.timezone_offset }}",
        latitude: "{{ form_data.latitude }}",
        longitude: "{{ form_data.longitude }}",
        musicGenre: "{{ form_data.other_genre if form_data.music_genre == 'other' and form_data.other_genre else form_data.music_genre }}"
    };
    {% endif %}
</script>
{% endblock %}

{% block og_title %}{{ chart_data.sun }} â˜‰ {{ chart_data.moon }} â˜½ {{ chart_data.ascendant }} â¬† - Astro Horoscope{%
endblock %}
{% block og_description %}Your personalized astrological chart reveals {{ chart_data.sun }} sun, {{ chart_data.moon }}
moon, and {{ chart_data.ascendant }} rising. Discover your cosmic vibes with AI-powered insights! âœ¨{% endblock %}

{% block twitter_title %}My Astrological Chart: {{ chart_data.sun }} â˜‰ {{ chart_data.moon }} â˜½ {{ chart_data.ascendant
}} â¬†{% endblock %}
{% block twitter_description %}Just got my cosmic vibe check! {{ chart_data.sun }} sun, {{ chart_data.moon }} moon, {{
chart_data.ascendant }} rising. Check yours out too! âœ¨ğŸŒ™â­{% endblock %}

{% block meta_description %}Personalized astrological chart showing {{ chart_data.sun }} sun sign, {{ chart_data.moon }}
moon sign, and {{ chart_data.ascendant }} rising sign with AI-powered cosmic insights.{% endblock %}

{% block content %}
{% if streaming %}
<script>document.body.dataset.streaming = 'true';</script>
{% endif %}
<!-- Sparkle Animation Container -->
<div class="sparkle-container" id="sparkleContainer"></div>

<h1>ğŸŒŸ <i>Astro Horoscope</i></h1>

<!-- AI Astrology Analysis Section -->
<div class="analysis-section" data-sun="{{ chart_data.sun }}" data-moon="{{ chart_data.moon }}"
    data-ascendant="{{ chart_data.ascendant }}">
    <div class="analysis-content" id="analysisContent">
        {% if streaming %}
        <!-- Content will be loaded via streaming JavaScript -->
        {% else %}
        {{ chart_data.astrology_analysis | markdown | safe }}
        {% endif %}
        <!-- Music Suggestion (loaded async, appears inline at the end) -->
        <div id="music-suggestion-placeholder" data-chart-type="daily"></div>
    </div>
    <button id="copyAnalysisBtn" class="copy-btn copy-btn-small copy-btn-float" onclick="copyAnalysis()"
        title="Copy your horoscope">
        ğŸ“‹
    </button>
</div>

<div class="chart-section">
    <h2><i>Your Main Signs</i></h2>
    <div class="main-signs">
        <div class="sign-card">
            <h3>â˜€ï¸ Sun Sign</h3>
            <p><strong>{{ chart_data.sun }}</strong></p>
            <small>Your core identity</small>
        </div>
        <div class="sign-card">
            <h3>ğŸŒ™ Moon Sign</h3>
            <p><strong>{{ chart_data.moon }}</strong></p>
            <small>Your emotional nature</small>
        </div>
        <div class="sign-card">
            <h3>â¬†ï¸ Ascendant</h3>
            <p><strong>{{ chart_data.ascendant }}</strong></p>
            <small>Your outer personality</small>
        </div>
    </div>
</div>

<!-- Mercury Retrograde Warning (if applicable) -->
{% if chart_data.mercury_retrograde %}
<div class="chart-section">
    <div class="mercury-status mercury-retrograde">
        âš ï¸ Mercury is currently retrograde!
    </div>
</div>
{% endif %}

<div class="navigation-links">
    <a href="/" class="back-link">â† Get another horoscope</a>
    <form action="/full-chart" method="POST" style="display: inline;">
        <input type="hidden" name="birth_date" value="{{ form_data.birth_date }}">
        <input type="hidden" name="birth_time" value="{{ form_data.birth_time }}">
        <input type="hidden" name="timezone_offset" value="{{ form_data.timezone_offset }}">
        <input type="hidden" name="latitude" value="{{ form_data.latitude }}">
        <input type="hidden" name="longitude" value="{{ form_data.longitude }}">
        <input type="hidden" name="music_genre" value="{{ form_data.music_genre }}">
        <input type="hidden" name="other_genre" value="{{ form_data.other_genre }}">
        <button type="submit">View Full Chart ğŸ“Š</button>
    </form>
</div>
{% endblock %}