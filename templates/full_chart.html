{% extends "base.html" %}

{% block title %}Your Complete Natal Chart - Astro Horoscope{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/copy-analysis.js') }}"></script>
<script src="{{ url_for('static', filename='js/music-suggestion.js') }}"></script>
{% if streaming %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="{{ url_for('static', filename='js/stream-analysis.js') }}"></script>
{% endif %}
{% if show_chart_wheel %}
<script src="{{ url_for('static', filename='js/chart-wheel.js') }}"></script>
<script>
    // Pass chart data to JavaScript
    window.chartData = {
        sun: "{{ chart_data.sun }}",
        moon: "{{ chart_data.moon }}",
        ascendant: "{{ chart_data.ascendant }}",
        planets: {{ chart_data.planets | tojson | safe }},
        houses: {{ chart_data.houses | tojson | safe }}
    };
</script>
{% endif %}
<script>
    // Pass chart data to JavaScript for music suggestion
    window.chartDataForMusic = {
        birthDate: "{{ form_data.birth_date }}",
        birthTime: "{{ form_data.birth_time }}",
        timezoneOffset: "{{ form_data.timezone_offset }}",
        latitude: "{{ form_data.latitude }}",
        longitude: "{{ form_data.longitude }}",
        musicGenre: "{{ form_data.other_genre if form_data.music_genre == 'other' and form_data.other_genre else form_data.music_genre }}"
    };
    
    {% if streaming %}
    // Pass chart data for streaming analysis
    window.chartDataForStreaming = {
        pageType: 'full-chart',
        birthDate: "{{ form_data.birth_date }}",
        birthTime: "{{ form_data.birth_time }}",
        timezoneOffset: "{{ form_data.timezone_offset }}",
        latitude: "{{ form_data.latitude }}",
        longitude: "{{ form_data.longitude }}",
        musicGenre: "{{ form_data.other_genre if form_data.music_genre == 'other' and form_data.other_genre else form_data.music_genre }}"
    };
    {% endif %}
</script>
{% endblock %}

{% block og_title %}{{ chart_data.sun }} â˜‰ {{ chart_data.moon }} â˜½ {{ chart_data.ascendant }} â¬† - Complete Natal Chart{% endblock %}
{% block og_description %}Comprehensive astrological natal chart with all planets, houses, and aspects for {{ chart_data.sun }} sun, {{ chart_data.moon }} moon, and {{ chart_data.ascendant }} rising. âœ¨ğŸŒŸ{% endblock %}

{% block twitter_title %}My Complete Natal Chart: {{ chart_data.sun }} â˜‰ {{ chart_data.moon }} â˜½ {{ chart_data.ascendant }} â¬†{% endblock %}
{% block twitter_description %}Check out my complete astrological natal chart with all planets, houses, and aspects! âœ¨ğŸŒŸâ­{% endblock %}

{% block meta_description %}Complete natal chart showing all planets, houses, and aspects for {{ chart_data.sun }} sun sign, {{ chart_data.moon }} moon sign, and {{ chart_data.ascendant }} rising sign.{% endblock %}

{% block content %}
{% if streaming %}
<script>document.body.dataset.streaming = 'true';</script>
{% endif %}
<!-- Sparkle Animation Container -->
<div class="sparkle-container" id="sparkleContainer"></div>

<h1>ğŸŒŸ <i>Your Complete Natal Chart</i></h1>

<!-- AI Astrology Analysis Section -->
<div class="analysis-section" 
     data-sun="{{ chart_data.sun }}" 
     data-moon="{{ chart_data.moon }}" 
     data-ascendant="{{ chart_data.ascendant }}">
    <h2>ğŸ”® <i>Your Complete Chart Analysis</i></h2>
    <div class="analysis-content" id="analysisContent">
        {% if streaming %}
        <!-- Content will be loaded via streaming JavaScript -->
        {% else %}
        {{ chart_data.astrology_analysis | markdown | safe }}
        {% endif %}
        <!-- Music Suggestion (loaded async, appears inline at the end) -->
        <div id="music-suggestion-placeholder" data-chart-type="natal"></div>
    </div>
    <button id="copyAnalysisBtn" class="copy-btn copy-btn-small copy-btn-float" onclick="copyAnalysis()" title="Copy your chart analysis">
        ğŸ“‹
    </button>
</div>

<!-- Chart Wheel Visualization -->
{% if show_chart_wheel %}
<div class="chart-wheel-container">
    <h2>ğŸŒŸ <i>Your Astrological Chart</i></h2>
    <div class="chart-wheel-wrapper">
        <canvas id="chartWheel"></canvas>
    </div>
    <div class="chart-legend">
        <div class="legend-section">
            <strong>Planets:</strong>
            <div class="legend-item">
                <span class="legend-symbol" style="color: #FDB813;">â˜‰</span> Sun
                <span class="legend-symbol" style="color: #8B7355;">â˜½</span> Moon
                <span class="legend-symbol" style="color: #4A90E2;">â˜¿</span> Mercury
                <span class="legend-symbol" style="color: #E74C3C;">â™€</span> Venus
                <span class="legend-symbol" style="color: #C0392B;">â™‚</span> Mars
                <span class="legend-symbol" style="color: #F39C12;">â™ƒ</span> Jupiter
            </div>
            <div class="legend-item">
                <span class="legend-symbol" style="color: #7F8C8D;">â™„</span> Saturn
                <span class="legend-symbol" style="color: #16A085;">â™…</span> Uranus
                <span class="legend-symbol" style="color: #2980B9;">â™†</span> Neptune
                <span class="legend-symbol" style="color: #34495E;">â™‡</span> Pluto
                <span class="legend-symbol" style="color: #9B59B6;">âš·</span> Chiron
            </div>
        </div>
        <div class="legend-section">
            <strong>Aspects:</strong>
            <div class="legend-item">
                <span class="aspect-line" style="background: #FF6B6B;"></span> Conjunction (0Â°)
                <span class="aspect-line" style="background: #3498DB;"></span> Trine (120Â°)
                <span class="aspect-line" style="background: #E67E22;"></span> Square (90Â°)
                <span class="aspect-line" style="background: #E74C3C;"></span> Opposition (180Â°)
                <span class="aspect-line" style="background: #9B59B6;"></span> Sextile (60Â°)
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Main Signs -->
<div class="chart-section">
    <h2><i>Your Main Signs</i></h2>
    <div class="main-signs">
        <div class="sign-card">
            <h3>â˜€ï¸ Sun Sign</h3>
            <p><strong>{{ chart_data.sun }}</strong></p>
            <small>Your core identity</small>
        </div>
        <div class="sign-card">
            <h3>ğŸŒ™ Moon Sign</h3>
            <p><strong>{{ chart_data.moon }}</strong></p>
            <small>Your emotional nature</small>
        </div>
        <div class="sign-card">
            <h3>â¬†ï¸ Ascendant</h3>
            <p><strong>{{ chart_data.ascendant }}</strong></p>
            <small>Your outer personality</small>
        </div>
    </div>
</div>

<!-- All Planets -->
<div class="chart-section">
    <h2>ğŸª <i>All Planets</i></h2>
    <div class="planets-grid">
        {% for planet_name, planet_data in chart_data.planets.items() %}
        <div class="planet-card">
            <h4>
                {% if planet_name == 'Sun' %}â˜€ï¸
                {% elif planet_name == 'Moon' %}ğŸŒ™
                {% elif planet_name == 'Mercury' %}â˜¿ï¸
                {% elif planet_name == 'Venus' %}â™€ï¸
                {% elif planet_name == 'Mars' %}â™‚ï¸
                {% elif planet_name == 'Jupiter' %}â™ƒ
                {% elif planet_name == 'Saturn' %}â™„
                {% elif planet_name == 'Uranus' %}â™…
                {% elif planet_name == 'Neptune' %}â™†
                {% elif planet_name == 'Pluto' %}â™‡
                {% elif planet_name == 'Chiron' %}âš·
                {% endif %}
                {{ planet_name }}
            </h4>
            <p><strong>{{ planet_data.sign }}</strong></p>
            <small>{{ planet_data.degree|round(2) }}Â°</small>
            {% if planet_data.house %}
            <small class="house-info">House {{ planet_data.house }}</small>
            {% endif %}
            <div class="planet-description">
                {% if planet_name == 'Sun' %}Your core identity, ego, and life purpose. Represents your conscious will and vitality.
                {% elif planet_name == 'Moon' %}Your emotions, instincts, and subconscious patterns. How you nurture and need to be nurtured.
                {% elif planet_name == 'Mercury' %}Communication, thinking, and learning style. How you process and share information.
                {% elif planet_name == 'Venus' %}Love, beauty, relationships, and values. What you find attractive and how you show affection.
                {% elif planet_name == 'Mars' %}Energy, passion, drive, and how you take action. Your assertiveness and sexual energy.
                {% elif planet_name == 'Jupiter' %}Growth, expansion, luck, and wisdom. Your beliefs, optimism, and opportunities for abundance.
                {% elif planet_name == 'Saturn' %}Discipline, responsibility, and life lessons. Challenges that lead to mastery and maturity.
                {% elif planet_name == 'Uranus' %}Innovation, rebellion, and sudden changes. Your uniqueness and desire for freedom.
                {% elif planet_name == 'Neptune' %}Dreams, intuition, and spirituality. Your imagination, compassion, and connection to the divine.
                {% elif planet_name == 'Pluto' %}Transformation, power, and regeneration. Deep psychological changes and hidden resources.
                {% elif planet_name == 'Chiron' %}The wounded healer. Past wounds that become sources of wisdom and healing for others.
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Houses -->
<div class="chart-section">
    <h2>ğŸ  <i>Houses</i></h2>
    <div class="houses-grid">
        {% for house_number in range(1, 13) %}
        {% set house_data = chart_data.houses[house_number] %}
        <div class="house-card">
            <h4>
                {% if house_number == 1 %}ğŸª
                {% elif house_number == 2 %}ğŸ’°
                {% elif house_number == 3 %}ğŸ’¬
                {% elif house_number == 4 %}ğŸ¡
                {% elif house_number == 5 %}ğŸ¨
                {% elif house_number == 6 %}ğŸ§‘â€ğŸ’¼
                {% elif house_number == 7 %}ğŸ¤
                {% elif house_number == 8 %}ğŸ”„
                {% elif house_number == 9 %}ğŸŒ
                {% elif house_number == 10 %}ğŸ†
                {% elif house_number == 11 %}ğŸ‘¥
                {% elif house_number == 12 %}ğŸ”®
                {% endif %}
                {{ house_number }}{{ 'st' if house_number == 1 else 'nd' if house_number == 2 else 'rd' if house_number == 3 else 'th' }} House
            </h4>
            <div class="house-title">
                {% if house_number == 1 %}<strong>Self & Identity</strong>
                {% elif house_number == 2 %}<strong>Money & Values</strong>
                {% elif house_number == 3 %}<strong>Communication</strong>
                {% elif house_number == 4 %}<strong>Home & Family</strong>
                {% elif house_number == 5 %}<strong>Creativity & Romance</strong>
                {% elif house_number == 6 %}<strong>Health & Work</strong>
                {% elif house_number == 7 %}<strong>Partnerships</strong>
                {% elif house_number == 8 %}<strong>Transformation</strong>
                {% elif house_number == 9 %}<strong>Philosophy & Travel</strong>
                {% elif house_number == 10 %}<strong>Career & Reputation</strong>
                {% elif house_number == 11 %}<strong>Friends & Hopes</strong>
                {% elif house_number == 12 %}<strong>Spirituality & Subconscious</strong>
                {% endif %}
            </div>

            <p><strong>{{ house_data.sign }}</strong></p>
            <small>{{ house_data.degree|round(2) }}Â°</small>
            {% if house_data.planets %}
            <div class="house-planets">
                {% for planet in house_data.planets %}
                <span class="planet-badge">{{ planet.name }}</span>
                {% endfor %}
            </div>
            {% endif %}
            <div class="house-description">
                {% if house_number == 1 %}Your outer personality, first impressions, and how you present yourself to the world
                {% elif house_number == 2 %}Your relationship with money, possessions, self-worth, and personal values
                {% elif house_number == 3 %}Communication style, siblings, short trips, and day-to-day interactions
                {% elif house_number == 4 %}Family roots, home environment, emotional foundation, and inner security
                {% elif house_number == 5 %}Creative expression, romance, children, fun, and personal joy
                {% elif house_number == 6 %}Daily routines, health habits, work environment, and service to others
                {% elif house_number == 7 %}Romantic partnerships, business relationships, and one-on-one connections
                {% elif house_number == 8 %}Shared resources, transformation, psychology, and life's mysteries
                {% elif house_number == 9 %}Higher education, philosophy, long-distance travel, and spiritual beliefs
                {% elif house_number == 10 %}Career path, public image, reputation, and life direction
                {% elif house_number == 11 %}Friendships, group activities, hopes, dreams, and social causes
                {% elif house_number == 12 %}Subconscious mind, spirituality, hidden strengths, and inner healing
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="navigation-links">
    <a href="/" class="back-link">â† Get another horoscope</a>
</div>
{% endblock %}
