{% extends "base.html" %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/location-map.js') }}"></script>
<script src="{{ url_for('static', filename='js/music-genre.js') }}"></script>
<script src="{{ url_for('static', filename='js/form-persistence.js') }}"></script>
<script src="{{ url_for('static', filename='js/button-loading.js') }}"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
{% endblock %}

{% block content %}
<h1>ğŸŒŸ <i>Astro Horoscope</i></h1>
<p class="intro-text">Enter your birth information to generate your natal chart to get a super chill super accurate horoscope</p>

<!-- Form data status indicator -->
<div id="formDataStatus" class="form-data-status">
    ğŸ“‚ <strong>Restored your previous form data!</strong> Feel free to make any changes.
</div>

<form action="/chart" method="POST">
    <div class="form-group">
        <label for="birth_date">Birth Date:</label>
        <input type="date" id="birth_date" name="birth_date" required>
    </div>
    
    <div class="form-group">
        <label for="birth_time">Birth Time:</label>
        <input type="time" id="birth_time" name="birth_time" required>
    </div>
    
    <div class="form-group">
        <label for="timezone_offset">Timezone Offset (e.g., -04:00 for EDT, -05:00 for EST):</label>
        <input type="text" id="timezone_offset" name="timezone_offset" required 
               placeholder="-04:00" pattern="[+\-]?\d{1,2}:\d{2}">
        <small class="field-hint">Format: +/-HH:MM (include daylight savings adjustment)</small>
    </div>
    
    <div class="form-group">
        <label for="music_genre">ğŸµ Preferred Music Genre for Recommendations:</label>
        <select id="music_genre" name="music_genre" onchange="toggleOtherGenre()">
            <option value="any">Any Genre (Surprise Me!)</option>
            <option value="pop">Pop</option>
            <option value="rock">Rock</option>
            <option value="hip-hop">Hip-Hop/Rap</option>
            <option value="r&b">R&B/Soul</option>
            <option value="indie">Indie</option>
            <option value="electronic">Electronic/EDM</option>
            <option value="folk">Folk/Acoustic</option>
            <option value="jazz">Jazz</option>
            <option value="classical">Classical</option>
            <option value="country">Country</option>
            <option value="reggae">Reggae</option>
            <option value="metal">Metal</option>
            <option value="punk">Punk</option>
            <option value="alternative">Alternative</option>
            <option value="latin">Latin</option>
            <option value="k-pop">K-Pop</option>
            <option value="other">Other (specify below)</option>
        </select>
        <div id="other_genre_div" class="other-genre-input">
            <input type="text" id="other_genre" name="other_genre" placeholder="Specify your preferred genre...">
        </div>
        <small class="field-hint">This helps customize song recommendations in your horoscope</small>
    </div>
    
    <!-- Interactive Location Selector -->
    <div class="form-group">
        <label>ğŸ“ Select Birth Location:</label>
        <div class="location-selector">
            <div class="location-search">
                <input type="text" id="locationSearch" placeholder="Search for a city or address...">
                <button type="button" onclick="searchLocation()">
                    Search
                </button>
            </div>
            <div id="locationMap"></div>
            <div id="locationDisplay">
                Click on the map or search for a location to set your birth place
            </div>
        </div>
    </div>
    
    <div class="form-group">
        <label for="latitude">Latitude (auto-filled from map):</label>
        <input type="text" id="latitude" name="latitude" required 
               placeholder="40n42" readonly>
        <small class="field-hint">Format: DDnMM for North, DDsM for South</small>
    </div>
    
    <div class="form-group">
        <label for="longitude">Longitude (auto-filled from map):</label>
        <input type="text" id="longitude" name="longitude" required 
               placeholder="74w00" readonly>
        <small class="field-hint">Format: DDwMM for West, DDeMM for East</small>
    </div>
    
    <div class="button-group">
        <button type="submit" formaction="/chart">Get Horoscope ğŸ”®</button>
        <button type="submit" formaction="/full-chart">Full Chart ğŸ“Š</button>
        <button type="submit" formaction="/live-mas">Live MÃ¡s ğŸ””</button>
    </div>
    
    <div class="clear-data-container">
        <button type="button" id="resetFormBtn" class="clear-data-btn"
                title="Clear all saved form data">
            ğŸ—‘ï¸ Clear Saved Data
        </button>
    </div>
</form>

<div class="location-help">
    <h3>ğŸ“ Location Help</h3>
    <p><strong>ğŸ—ºï¸ Using the Interactive Map:</strong></p>
    <ul>
        <li>Click anywhere on the map to set your birth location</li>
        <li>Search for your birth city in the search box above the map</li>
        <li>The map will automatically detect your current location (if you allow it)</li>
        <li>Coordinates will be automatically converted to astrology format</li>
    </ul>
    <p><small>ğŸ’¡ The map makes it easy to find your exact birth location - just click or search!</small></p>
</div>
{% endblock %}
